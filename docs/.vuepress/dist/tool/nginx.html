<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>文档搬运工</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="学习笔记，包含前端开发、后端开发、服务器运维等">
    
    <link rel="preload" href="/assets/css/0.styles.fad71e8e.css" as="style"><link rel="preload" href="/assets/js/app.c8ed8bcf.js" as="script"><link rel="preload" href="/assets/js/2.f44a4f26.js" as="script"><link rel="preload" href="/assets/js/128.029c8965.js" as="script"><link rel="prefetch" href="/assets/js/10.68d16472.js"><link rel="prefetch" href="/assets/js/100.9d57c6dd.js"><link rel="prefetch" href="/assets/js/101.7685a749.js"><link rel="prefetch" href="/assets/js/102.1dae5789.js"><link rel="prefetch" href="/assets/js/103.31c8c6f7.js"><link rel="prefetch" href="/assets/js/104.1aabc831.js"><link rel="prefetch" href="/assets/js/105.f188b2cc.js"><link rel="prefetch" href="/assets/js/106.7706f598.js"><link rel="prefetch" href="/assets/js/107.98bf6cba.js"><link rel="prefetch" href="/assets/js/108.78c41dbf.js"><link rel="prefetch" href="/assets/js/109.a8c6ac5f.js"><link rel="prefetch" href="/assets/js/11.e0ba19d3.js"><link rel="prefetch" href="/assets/js/110.2cccc8fa.js"><link rel="prefetch" href="/assets/js/111.19a4e086.js"><link rel="prefetch" href="/assets/js/112.d940b1c0.js"><link rel="prefetch" href="/assets/js/113.58a5e756.js"><link rel="prefetch" href="/assets/js/114.950b8113.js"><link rel="prefetch" href="/assets/js/115.9712a524.js"><link rel="prefetch" href="/assets/js/116.dacaa4fa.js"><link rel="prefetch" href="/assets/js/117.a91f9e15.js"><link rel="prefetch" href="/assets/js/118.84772b6e.js"><link rel="prefetch" href="/assets/js/119.6e3567ca.js"><link rel="prefetch" href="/assets/js/12.67495675.js"><link rel="prefetch" href="/assets/js/120.9eb24a02.js"><link rel="prefetch" href="/assets/js/121.38bbf647.js"><link rel="prefetch" href="/assets/js/122.2f7ab3f4.js"><link rel="prefetch" href="/assets/js/123.419b99f0.js"><link rel="prefetch" href="/assets/js/124.4764bbe8.js"><link rel="prefetch" href="/assets/js/125.87d74ae9.js"><link rel="prefetch" href="/assets/js/126.3bbeef41.js"><link rel="prefetch" href="/assets/js/127.8bdba5aa.js"><link rel="prefetch" href="/assets/js/129.ee2d4363.js"><link rel="prefetch" href="/assets/js/13.6727ab98.js"><link rel="prefetch" href="/assets/js/130.42157c82.js"><link rel="prefetch" href="/assets/js/131.f62c81df.js"><link rel="prefetch" href="/assets/js/14.70b0cf01.js"><link rel="prefetch" href="/assets/js/15.ba9580a7.js"><link rel="prefetch" href="/assets/js/16.1a8c733f.js"><link rel="prefetch" href="/assets/js/17.6657a227.js"><link rel="prefetch" href="/assets/js/18.65942dbb.js"><link rel="prefetch" href="/assets/js/19.7d801cca.js"><link rel="prefetch" href="/assets/js/20.7ca56ddb.js"><link rel="prefetch" href="/assets/js/21.a30264d9.js"><link rel="prefetch" href="/assets/js/22.fca662dd.js"><link rel="prefetch" href="/assets/js/23.1a059155.js"><link rel="prefetch" href="/assets/js/24.d9971ac4.js"><link rel="prefetch" href="/assets/js/25.6c1d4926.js"><link rel="prefetch" href="/assets/js/26.21e8c7b4.js"><link rel="prefetch" href="/assets/js/27.cfff7ef0.js"><link rel="prefetch" href="/assets/js/28.405bf1b8.js"><link rel="prefetch" href="/assets/js/29.3872d2cb.js"><link rel="prefetch" href="/assets/js/3.d00959e5.js"><link rel="prefetch" href="/assets/js/30.fea18838.js"><link rel="prefetch" href="/assets/js/31.364afb36.js"><link rel="prefetch" href="/assets/js/32.3a14b962.js"><link rel="prefetch" href="/assets/js/33.ebb8c231.js"><link rel="prefetch" href="/assets/js/34.bbba3f86.js"><link rel="prefetch" href="/assets/js/35.ebc83e54.js"><link rel="prefetch" href="/assets/js/36.949b4b98.js"><link rel="prefetch" href="/assets/js/37.63a219a5.js"><link rel="prefetch" href="/assets/js/38.2abdd62c.js"><link rel="prefetch" href="/assets/js/39.f31baba8.js"><link rel="prefetch" href="/assets/js/4.7ac2b204.js"><link rel="prefetch" href="/assets/js/40.f1973b4d.js"><link rel="prefetch" href="/assets/js/41.b2b7deaa.js"><link rel="prefetch" href="/assets/js/42.94a89008.js"><link rel="prefetch" href="/assets/js/43.cb36fa9a.js"><link rel="prefetch" href="/assets/js/44.d3cdaea4.js"><link rel="prefetch" href="/assets/js/45.6cedb636.js"><link rel="prefetch" href="/assets/js/46.d7f3520c.js"><link rel="prefetch" href="/assets/js/47.c34ac17e.js"><link rel="prefetch" href="/assets/js/48.d9fffe3c.js"><link rel="prefetch" href="/assets/js/49.a8a8fe51.js"><link rel="prefetch" href="/assets/js/5.f702624b.js"><link rel="prefetch" href="/assets/js/50.d67120fa.js"><link rel="prefetch" href="/assets/js/51.828b01e6.js"><link rel="prefetch" href="/assets/js/52.a09e7b67.js"><link rel="prefetch" href="/assets/js/53.78d609f7.js"><link rel="prefetch" href="/assets/js/54.56dd39fd.js"><link rel="prefetch" href="/assets/js/55.59d3c972.js"><link rel="prefetch" href="/assets/js/56.e8d448dc.js"><link rel="prefetch" href="/assets/js/57.b25a333a.js"><link rel="prefetch" href="/assets/js/58.3a58c623.js"><link rel="prefetch" href="/assets/js/59.d45955ca.js"><link rel="prefetch" href="/assets/js/6.c76c0e1e.js"><link rel="prefetch" href="/assets/js/60.70ea5158.js"><link rel="prefetch" href="/assets/js/61.39efc969.js"><link rel="prefetch" href="/assets/js/62.492b7cb3.js"><link rel="prefetch" href="/assets/js/63.c955736f.js"><link rel="prefetch" href="/assets/js/64.7249d228.js"><link rel="prefetch" href="/assets/js/65.df7d1f53.js"><link rel="prefetch" href="/assets/js/66.0993568b.js"><link rel="prefetch" href="/assets/js/67.ef9dd414.js"><link rel="prefetch" href="/assets/js/68.65bb0d00.js"><link rel="prefetch" href="/assets/js/69.5e0c247c.js"><link rel="prefetch" href="/assets/js/7.96bc15e3.js"><link rel="prefetch" href="/assets/js/70.f563832a.js"><link rel="prefetch" href="/assets/js/71.f9db52a9.js"><link rel="prefetch" href="/assets/js/72.704dde50.js"><link rel="prefetch" href="/assets/js/73.f196359d.js"><link rel="prefetch" href="/assets/js/74.616d3b86.js"><link rel="prefetch" href="/assets/js/75.8a040688.js"><link rel="prefetch" href="/assets/js/76.bb1c773f.js"><link rel="prefetch" href="/assets/js/77.764a298e.js"><link rel="prefetch" href="/assets/js/78.7a1fb4f4.js"><link rel="prefetch" href="/assets/js/79.6c2f29c0.js"><link rel="prefetch" href="/assets/js/8.f652ff79.js"><link rel="prefetch" href="/assets/js/80.2d0b63c6.js"><link rel="prefetch" href="/assets/js/81.3aa6d63c.js"><link rel="prefetch" href="/assets/js/82.26b67013.js"><link rel="prefetch" href="/assets/js/83.04d03012.js"><link rel="prefetch" href="/assets/js/84.c2c2bb57.js"><link rel="prefetch" href="/assets/js/85.529d11ae.js"><link rel="prefetch" href="/assets/js/86.4c1e0495.js"><link rel="prefetch" href="/assets/js/87.fd3ba140.js"><link rel="prefetch" href="/assets/js/88.bda10190.js"><link rel="prefetch" href="/assets/js/89.adb017da.js"><link rel="prefetch" href="/assets/js/9.6b06aa53.js"><link rel="prefetch" href="/assets/js/90.a8757e00.js"><link rel="prefetch" href="/assets/js/91.a492ff4f.js"><link rel="prefetch" href="/assets/js/92.c6410bf2.js"><link rel="prefetch" href="/assets/js/93.5ec8e566.js"><link rel="prefetch" href="/assets/js/94.a0e9ad4f.js"><link rel="prefetch" href="/assets/js/95.3010b85f.js"><link rel="prefetch" href="/assets/js/96.99ce2ecd.js"><link rel="prefetch" href="/assets/js/97.91811599.js"><link rel="prefetch" href="/assets/js/98.3becd40f.js"><link rel="prefetch" href="/assets/js/99.a166247a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fad71e8e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">文档搬运工</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/feds.html" class="nav-link">
  前端导航
</a></li><li class="dropdown-item"><!----> <a href="/frontend/css.html" class="nav-link">
  CSS3
</a></li><li class="dropdown-item"><!----> <a href="/frontend/electron.html" class="nav-link">
  Electron
</a></li><li class="dropdown-item"><!----> <a href="/frontend/es6.html" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/frontend/styled-components.html" class="nav-link">
  Styled Components
</a></li><li class="dropdown-item"><!----> <a href="/frontend/stylus.html" class="nav-link">
  Stylus
</a></li><li class="dropdown-item"><!----> <a href="/frontend/sass.html" class="nav-link">
  Sass
</a></li><li class="dropdown-item"><!----> <a href="/frontend/html.html" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/frontend/javascript.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/frontend/jquery.html" class="nav-link">
  jQuery
</a></li><li class="dropdown-item"><!----> <a href="/frontend/lessjs.html" class="nav-link">
  Less
</a></li><li class="dropdown-item"><!----> <a href="/frontend/nextjs.html" class="nav-link">
  Next
</a></li><li class="dropdown-item"><!----> <a href="/frontend/react.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/frontend/reactrouter.html" class="nav-link">
  React Router
</a></li><li class="dropdown-item"><!----> <a href="/frontend/react-native.html" class="nav-link">
  React Native
</a></li><li class="dropdown-item"><!----> <a href="/frontend/regex.html" class="nav-link">
  Regex 正则表达式
</a></li><li class="dropdown-item"><!----> <a href="/frontend/typescript.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/frontend/tailwindcss.html" class="nav-link">
  Tailwind CSS
</a></li><li class="dropdown-item"><!----> <a href="/frontend/vue2.html" class="nav-link">
  Vue2
</a></li><li class="dropdown-item"><!----> <a href="/frontend/vue.html" class="nav-link">
  Vue3
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程" class="dropdown-title"><span class="title">编程</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程" class="mobile-dropdown-title"><span class="title">编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/program/bash.html" class="nav-link">
  Bash
</a></li><li class="dropdown-item"><!----> <a href="/program/c.html" class="nav-link">
  C
</a></li><li class="dropdown-item"><!----> <a href="/program/cpp.html" class="nav-link">
  C++
</a></li><li class="dropdown-item"><!----> <a href="/program/dart.html" class="nav-link">
  Dart
</a></li><li class="dropdown-item"><!----> <a href="/program/docker.html" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/program/flutter.html" class="nav-link">
  Flutter
</a></li><li class="dropdown-item"><!----> <a href="/program/golang.html" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/program/graphql.html" class="nav-link">
  GraphQL
</a></li><li class="dropdown-item"><!----> <a href="/program/java.html" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/program/json.html" class="nav-link">
  JSON
</a></li><li class="dropdown-item"><!----> <a href="/program/kubernetes.html" class="nav-link">
  Kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/program/markdown.html" class="nav-link">
  Markdown
</a></li><li class="dropdown-item"><!----> <a href="/program/matlab.html" class="nav-link">
  MATLAB
</a></li><li class="dropdown-item"><!----> <a href="/program/php.html" class="nav-link">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/program/python.html" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/program/ruby.html" class="nav-link">
  Ruby
</a></li><li class="dropdown-item"><!----> <a href="/program/rust.html" class="nav-link">
  Rust
</a></li><li class="dropdown-item"><!----> <a href="/program/swift.html" class="nav-link">
  Swift
</a></li><li class="dropdown-item"><!----> <a href="/program/swiftui.html" class="nav-link">
  SwiftUI
</a></li><li class="dropdown-item"><!----> <a href="/program/yaml.html" class="nav-link">
  YAML
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Nodejs" class="dropdown-title"><span class="title">Nodejs</span> <span class="arrow down"></span></button> <button type="button" aria-label="Nodejs" class="mobile-dropdown-title"><span class="title">Nodejs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/nodejs/expressjs.html" class="nav-link">
  Express.js
</a></li><li class="dropdown-item"><!----> <a href="/nodejs/jest.html" class="nav-link">
  Jest
</a></li><li class="dropdown-item"><!----> <a href="/nodejs/koajs.html" class="nav-link">
  Koa.js
</a></li><li class="dropdown-item"><!----> <a href="/nodejs/lerna.html" class="nav-link">
  Lerna
</a></li><li class="dropdown-item"><!----> <a href="/nodejs/npm.html" class="nav-link">
  npm
</a></li><li class="dropdown-item"><!----> <a href="/nodejs/nestjs.html" class="nav-link">
  NestJS
</a></li><li class="dropdown-item"><!----> <a href="/nodejs/pm2.html" class="nav-link">
  PM2
</a></li><li class="dropdown-item"><!----> <a href="/nodejs/package.json.html" class="nav-link">
  Package.json
</a></li><li class="dropdown-item"><!----> <a href="/nodejs/yarn.html" class="nav-link">
  Yarn
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/emacs.html" class="nav-link">
  Emacs
</a></li><li class="dropdown-item"><!----> <a href="/tool/github.html" class="nav-link">
  Github
</a></li><li class="dropdown-item"><!----> <a href="/tool/nginx.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/tool/semver.html" class="nav-link">
  Semver
</a></li><li class="dropdown-item"><!----> <a href="/tool/vim.html" class="nav-link">
  Vim
</a></li><li class="dropdown-item"><!----> <a href="/tool/xpath.html" class="nav-link">
  XPath
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="命令" class="dropdown-title"><span class="title">命令</span> <span class="arrow down"></span></button> <button type="button" aria-label="命令" class="mobile-dropdown-title"><span class="title">命令</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/command/adb.html" class="nav-link">
  ADB, Android Debug Bridge
</a></li><li class="dropdown-item"><!----> <a href="/command/conan.html" class="nav-link">
  Conan
</a></li><li class="dropdown-item"><!----> <a href="/command/conda.html" class="nav-link">
  Conda
</a></li><li class="dropdown-item"><!----> <a href="/command/cocoapods.html" class="nav-link">
  CocoaPods
</a></li><li class="dropdown-item"><!----> <a href="/command/cargo.html" class="nav-link">
  Cargo
</a></li><li class="dropdown-item"><!----> <a href="/command/curl.html" class="nav-link">
  Curl
</a></li><li class="dropdown-item"><!----> <a href="/command/chmod.html" class="nav-link">
  Chmod
</a></li><li class="dropdown-item"><!----> <a href="/command/cron.html" class="nav-link">
  Cron
</a></li><li class="dropdown-item"><!----> <a href="/command/cmake.html" class="nav-link">
  CMake
</a></li><li class="dropdown-item"><!----> <a href="/command/make.html" class="nav-link">
  Make
</a></li><li class="dropdown-item"><!----> <a href="/command/git.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/command/grep.html" class="nav-link">
  Grep
</a></li><li class="dropdown-item"><!----> <a href="/command/find.html" class="nav-link">
  Find
</a></li><li class="dropdown-item"><!----> <a href="/command/ffmpeg.html" class="nav-link">
  FFmpeg
</a></li><li class="dropdown-item"><!----> <a href="/command/htop.html" class="nav-link">
  Htop
</a></li><li class="dropdown-item"><!----> <a href="/command/homebrew.html" class="nav-link">
  Homebrew
</a></li><li class="dropdown-item"><!----> <a href="/command/netstat.html" class="nav-link">
  Netstat
</a></li><li class="dropdown-item"><!----> <a href="/command/iptables.html" class="nav-link">
  iptables
</a></li><li class="dropdown-item"><!----> <a href="/command/jq.html" class="nav-link">
  jq
</a></li><li class="dropdown-item"><!----> <a href="/command/justfile.html" class="nav-link">
  Justfile
</a></li><li class="dropdown-item"><!----> <a href="/command/lsof.html" class="nav-link">
  Lsof
</a></li><li class="dropdown-item"><!----> <a href="/command/mitmproxy.html" class="nav-link">
  Mitmproxy
</a></li><li class="dropdown-item"><!----> <a href="/command/netcat.html" class="nav-link">
  Netcat
</a></li><li class="dropdown-item"><!----> <a href="/command/sed.html" class="nav-link">
  Sed
</a></li><li class="dropdown-item"><!----> <a href="/command/openssl.html" class="nav-link">
  OpenSSL
</a></li><li class="dropdown-item"><!----> <a href="/command/ps.html" class="nav-link">
  ps
</a></li><li class="dropdown-item"><!----> <a href="/command/systemd.html" class="nav-link">
  Systemd
</a></li><li class="dropdown-item"><!----> <a href="/command/ssh.html" class="nav-link">
  SSH
</a></li><li class="dropdown-item"><!----> <a href="/command/screen.html" class="nav-link">
  Screen
</a></li><li class="dropdown-item"><!----> <a href="/command/yum.html" class="nav-link">
  YUM
</a></li><li class="dropdown-item"><!----> <a href="/command/cmd.html" class="nav-link">
  CMD
</a></li><li class="dropdown-item"><!----> <a href="/command/zip.html" class="nav-link">
  Zip
</a></li><li class="dropdown-item"><!----> <a href="/command/apt.html" class="nav-link">
  APT
</a></li><li class="dropdown-item"><!----> <a href="/command/tar.html" class="nav-link">
  tar
</a></li><li class="dropdown-item"><!----> <a href="/command/linux-command.html" class="nav-link">
  Linux Command
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/mysql.html" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/database/mongodb.html" class="nav-link">
  MongoDB
</a></li><li class="dropdown-item"><!----> <a href="/database/oracle.html" class="nav-link">
  Oracle
</a></li><li class="dropdown-item"><!----> <a href="/database/postgres.html" class="nav-link">
  PostgreSQL
</a></li><li class="dropdown-item"><!----> <a href="/database/redis.html" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="快捷键" class="dropdown-title"><span class="title">快捷键</span> <span class="arrow down"></span></button> <button type="button" aria-label="快捷键" class="mobile-dropdown-title"><span class="title">快捷键</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/quicklink/adobe-lightroom.html" class="nav-link">
  Adobe Lightroom
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/adobe-photoshop.html" class="nav-link">
  Adobe Photoshop
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/adobe-xd.html" class="nav-link">
  Adobe XD
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/android-studio.html" class="nav-link">
  Android Studio
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/firefox.html" class="nav-link">
  Firefox
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/gmail.html" class="nav-link">
  Gmail
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/gitlab.html" class="nav-link">
  Gitlab
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/google-chrome.html" class="nav-link">
  Google Chrome
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/intelli-j-idea.html" class="nav-link">
  IntelliJ IDEA
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/pycharm.html" class="nav-link">
  PyCharm
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/sketch.html" class="nav-link">
  Sketch
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/sublime-text.html" class="nav-link">
  Sublime Text
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/vscode.html" class="nav-link">
  VSCode
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/webstorm.html" class="nav-link">
  WebStorm
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/xcode.html" class="nav-link">
  Xcode
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它" class="dropdown-title"><span class="title">其它</span> <span class="arrow down"></span></button> <button type="button" aria-label="其它" class="mobile-dropdown-title"><span class="title">其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/aspect-ratio.html" class="nav-link">
  Aspect Ratio
</a></li><li class="dropdown-item"><!----> <a href="/other/github-actions.html" class="nav-link">
  Github Actions
</a></li><li class="dropdown-item"><!----> <a href="/other/gitlab-ci.html" class="nav-link">
  Gitlab CI/CD
</a></li><li class="dropdown-item"><!----> <a href="/other/colors-named.html" class="nav-link">
  Colors Named
</a></li><li class="dropdown-item"><!----> <a href="/other/http-status-code.html" class="nav-link">
  HTTP 状态码
</a></li><li class="dropdown-item"><!----> <a href="/other/html-char.html" class="nav-link">
  HTML 字符实体
</a></li><li class="dropdown-item"><!----> <a href="/other/iso-639-1.html" class="nav-link">
  ISO 639-1 Language Code
</a></li><li class="dropdown-item"><!----> <a href="/other/emoji.html" class="nav-link">
  Emoji
</a></li><li class="dropdown-item"><!----> <a href="/other/mime.html" class="nav-link">
  MIME types
</a></li><li class="dropdown-item"><!----> <a href="/other/resolutions.html" class="nav-link">
  Resolutions
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/feds.html" class="nav-link">
  前端导航
</a></li><li class="dropdown-item"><!----> <a href="/frontend/css.html" class="nav-link">
  CSS3
</a></li><li class="dropdown-item"><!----> <a href="/frontend/electron.html" class="nav-link">
  Electron
</a></li><li class="dropdown-item"><!----> <a href="/frontend/es6.html" class="nav-link">
  ES6
</a></li><li class="dropdown-item"><!----> <a href="/frontend/styled-components.html" class="nav-link">
  Styled Components
</a></li><li class="dropdown-item"><!----> <a href="/frontend/stylus.html" class="nav-link">
  Stylus
</a></li><li class="dropdown-item"><!----> <a href="/frontend/sass.html" class="nav-link">
  Sass
</a></li><li class="dropdown-item"><!----> <a href="/frontend/html.html" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/frontend/javascript.html" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/frontend/jquery.html" class="nav-link">
  jQuery
</a></li><li class="dropdown-item"><!----> <a href="/frontend/lessjs.html" class="nav-link">
  Less
</a></li><li class="dropdown-item"><!----> <a href="/frontend/nextjs.html" class="nav-link">
  Next
</a></li><li class="dropdown-item"><!----> <a href="/frontend/react.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/frontend/reactrouter.html" class="nav-link">
  React Router
</a></li><li class="dropdown-item"><!----> <a href="/frontend/react-native.html" class="nav-link">
  React Native
</a></li><li class="dropdown-item"><!----> <a href="/frontend/regex.html" class="nav-link">
  Regex 正则表达式
</a></li><li class="dropdown-item"><!----> <a href="/frontend/typescript.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><!----> <a href="/frontend/tailwindcss.html" class="nav-link">
  Tailwind CSS
</a></li><li class="dropdown-item"><!----> <a href="/frontend/vue2.html" class="nav-link">
  Vue2
</a></li><li class="dropdown-item"><!----> <a href="/frontend/vue.html" class="nav-link">
  Vue3
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程" class="dropdown-title"><span class="title">编程</span> <span class="arrow down"></span></button> <button type="button" aria-label="编程" class="mobile-dropdown-title"><span class="title">编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/program/bash.html" class="nav-link">
  Bash
</a></li><li class="dropdown-item"><!----> <a href="/program/c.html" class="nav-link">
  C
</a></li><li class="dropdown-item"><!----> <a href="/program/cpp.html" class="nav-link">
  C++
</a></li><li class="dropdown-item"><!----> <a href="/program/dart.html" class="nav-link">
  Dart
</a></li><li class="dropdown-item"><!----> <a href="/program/docker.html" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/program/flutter.html" class="nav-link">
  Flutter
</a></li><li class="dropdown-item"><!----> <a href="/program/golang.html" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/program/graphql.html" class="nav-link">
  GraphQL
</a></li><li class="dropdown-item"><!----> <a href="/program/java.html" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/program/json.html" class="nav-link">
  JSON
</a></li><li class="dropdown-item"><!----> <a href="/program/kubernetes.html" class="nav-link">
  Kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/program/markdown.html" class="nav-link">
  Markdown
</a></li><li class="dropdown-item"><!----> <a href="/program/matlab.html" class="nav-link">
  MATLAB
</a></li><li class="dropdown-item"><!----> <a href="/program/php.html" class="nav-link">
  PHP
</a></li><li class="dropdown-item"><!----> <a href="/program/python.html" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/program/ruby.html" class="nav-link">
  Ruby
</a></li><li class="dropdown-item"><!----> <a href="/program/rust.html" class="nav-link">
  Rust
</a></li><li class="dropdown-item"><!----> <a href="/program/swift.html" class="nav-link">
  Swift
</a></li><li class="dropdown-item"><!----> <a href="/program/swiftui.html" class="nav-link">
  SwiftUI
</a></li><li class="dropdown-item"><!----> <a href="/program/yaml.html" class="nav-link">
  YAML
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Nodejs" class="dropdown-title"><span class="title">Nodejs</span> <span class="arrow down"></span></button> <button type="button" aria-label="Nodejs" class="mobile-dropdown-title"><span class="title">Nodejs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/nodejs/expressjs.html" class="nav-link">
  Express.js
</a></li><li class="dropdown-item"><!----> <a href="/nodejs/jest.html" class="nav-link">
  Jest
</a></li><li class="dropdown-item"><!----> <a href="/nodejs/koajs.html" class="nav-link">
  Koa.js
</a></li><li class="dropdown-item"><!----> <a href="/nodejs/lerna.html" class="nav-link">
  Lerna
</a></li><li class="dropdown-item"><!----> <a href="/nodejs/npm.html" class="nav-link">
  npm
</a></li><li class="dropdown-item"><!----> <a href="/nodejs/nestjs.html" class="nav-link">
  NestJS
</a></li><li class="dropdown-item"><!----> <a href="/nodejs/pm2.html" class="nav-link">
  PM2
</a></li><li class="dropdown-item"><!----> <a href="/nodejs/package.json.html" class="nav-link">
  Package.json
</a></li><li class="dropdown-item"><!----> <a href="/nodejs/yarn.html" class="nav-link">
  Yarn
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/emacs.html" class="nav-link">
  Emacs
</a></li><li class="dropdown-item"><!----> <a href="/tool/github.html" class="nav-link">
  Github
</a></li><li class="dropdown-item"><!----> <a href="/tool/nginx.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/tool/semver.html" class="nav-link">
  Semver
</a></li><li class="dropdown-item"><!----> <a href="/tool/vim.html" class="nav-link">
  Vim
</a></li><li class="dropdown-item"><!----> <a href="/tool/xpath.html" class="nav-link">
  XPath
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="命令" class="dropdown-title"><span class="title">命令</span> <span class="arrow down"></span></button> <button type="button" aria-label="命令" class="mobile-dropdown-title"><span class="title">命令</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/command/adb.html" class="nav-link">
  ADB, Android Debug Bridge
</a></li><li class="dropdown-item"><!----> <a href="/command/conan.html" class="nav-link">
  Conan
</a></li><li class="dropdown-item"><!----> <a href="/command/conda.html" class="nav-link">
  Conda
</a></li><li class="dropdown-item"><!----> <a href="/command/cocoapods.html" class="nav-link">
  CocoaPods
</a></li><li class="dropdown-item"><!----> <a href="/command/cargo.html" class="nav-link">
  Cargo
</a></li><li class="dropdown-item"><!----> <a href="/command/curl.html" class="nav-link">
  Curl
</a></li><li class="dropdown-item"><!----> <a href="/command/chmod.html" class="nav-link">
  Chmod
</a></li><li class="dropdown-item"><!----> <a href="/command/cron.html" class="nav-link">
  Cron
</a></li><li class="dropdown-item"><!----> <a href="/command/cmake.html" class="nav-link">
  CMake
</a></li><li class="dropdown-item"><!----> <a href="/command/make.html" class="nav-link">
  Make
</a></li><li class="dropdown-item"><!----> <a href="/command/git.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/command/grep.html" class="nav-link">
  Grep
</a></li><li class="dropdown-item"><!----> <a href="/command/find.html" class="nav-link">
  Find
</a></li><li class="dropdown-item"><!----> <a href="/command/ffmpeg.html" class="nav-link">
  FFmpeg
</a></li><li class="dropdown-item"><!----> <a href="/command/htop.html" class="nav-link">
  Htop
</a></li><li class="dropdown-item"><!----> <a href="/command/homebrew.html" class="nav-link">
  Homebrew
</a></li><li class="dropdown-item"><!----> <a href="/command/netstat.html" class="nav-link">
  Netstat
</a></li><li class="dropdown-item"><!----> <a href="/command/iptables.html" class="nav-link">
  iptables
</a></li><li class="dropdown-item"><!----> <a href="/command/jq.html" class="nav-link">
  jq
</a></li><li class="dropdown-item"><!----> <a href="/command/justfile.html" class="nav-link">
  Justfile
</a></li><li class="dropdown-item"><!----> <a href="/command/lsof.html" class="nav-link">
  Lsof
</a></li><li class="dropdown-item"><!----> <a href="/command/mitmproxy.html" class="nav-link">
  Mitmproxy
</a></li><li class="dropdown-item"><!----> <a href="/command/netcat.html" class="nav-link">
  Netcat
</a></li><li class="dropdown-item"><!----> <a href="/command/sed.html" class="nav-link">
  Sed
</a></li><li class="dropdown-item"><!----> <a href="/command/openssl.html" class="nav-link">
  OpenSSL
</a></li><li class="dropdown-item"><!----> <a href="/command/ps.html" class="nav-link">
  ps
</a></li><li class="dropdown-item"><!----> <a href="/command/systemd.html" class="nav-link">
  Systemd
</a></li><li class="dropdown-item"><!----> <a href="/command/ssh.html" class="nav-link">
  SSH
</a></li><li class="dropdown-item"><!----> <a href="/command/screen.html" class="nav-link">
  Screen
</a></li><li class="dropdown-item"><!----> <a href="/command/yum.html" class="nav-link">
  YUM
</a></li><li class="dropdown-item"><!----> <a href="/command/cmd.html" class="nav-link">
  CMD
</a></li><li class="dropdown-item"><!----> <a href="/command/zip.html" class="nav-link">
  Zip
</a></li><li class="dropdown-item"><!----> <a href="/command/apt.html" class="nav-link">
  APT
</a></li><li class="dropdown-item"><!----> <a href="/command/tar.html" class="nav-link">
  tar
</a></li><li class="dropdown-item"><!----> <a href="/command/linux-command.html" class="nav-link">
  Linux Command
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/mysql.html" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/database/mongodb.html" class="nav-link">
  MongoDB
</a></li><li class="dropdown-item"><!----> <a href="/database/oracle.html" class="nav-link">
  Oracle
</a></li><li class="dropdown-item"><!----> <a href="/database/postgres.html" class="nav-link">
  PostgreSQL
</a></li><li class="dropdown-item"><!----> <a href="/database/redis.html" class="nav-link">
  Redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="快捷键" class="dropdown-title"><span class="title">快捷键</span> <span class="arrow down"></span></button> <button type="button" aria-label="快捷键" class="mobile-dropdown-title"><span class="title">快捷键</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/quicklink/adobe-lightroom.html" class="nav-link">
  Adobe Lightroom
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/adobe-photoshop.html" class="nav-link">
  Adobe Photoshop
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/adobe-xd.html" class="nav-link">
  Adobe XD
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/android-studio.html" class="nav-link">
  Android Studio
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/firefox.html" class="nav-link">
  Firefox
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/gmail.html" class="nav-link">
  Gmail
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/gitlab.html" class="nav-link">
  Gitlab
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/google-chrome.html" class="nav-link">
  Google Chrome
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/intelli-j-idea.html" class="nav-link">
  IntelliJ IDEA
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/pycharm.html" class="nav-link">
  PyCharm
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/sketch.html" class="nav-link">
  Sketch
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/sublime-text.html" class="nav-link">
  Sublime Text
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/vscode.html" class="nav-link">
  VSCode
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/webstorm.html" class="nav-link">
  WebStorm
</a></li><li class="dropdown-item"><!----> <a href="/quicklink/xcode.html" class="nav-link">
  Xcode
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它" class="dropdown-title"><span class="title">其它</span> <span class="arrow down"></span></button> <button type="button" aria-label="其它" class="mobile-dropdown-title"><span class="title">其它</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/aspect-ratio.html" class="nav-link">
  Aspect Ratio
</a></li><li class="dropdown-item"><!----> <a href="/other/github-actions.html" class="nav-link">
  Github Actions
</a></li><li class="dropdown-item"><!----> <a href="/other/gitlab-ci.html" class="nav-link">
  Gitlab CI/CD
</a></li><li class="dropdown-item"><!----> <a href="/other/colors-named.html" class="nav-link">
  Colors Named
</a></li><li class="dropdown-item"><!----> <a href="/other/http-status-code.html" class="nav-link">
  HTTP 状态码
</a></li><li class="dropdown-item"><!----> <a href="/other/html-char.html" class="nav-link">
  HTML 字符实体
</a></li><li class="dropdown-item"><!----> <a href="/other/iso-639-1.html" class="nav-link">
  ISO 639-1 Language Code
</a></li><li class="dropdown-item"><!----> <a href="/other/emoji.html" class="nav-link">
  Emoji
</a></li><li class="dropdown-item"><!----> <a href="/other/mime.html" class="nav-link">
  MIME types
</a></li><li class="dropdown-item"><!----> <a href="/other/resolutions.html" class="nav-link">
  Resolutions
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tool/nginx.html#入门" class="sidebar-link">入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tool/nginx.html#服务管理" class="sidebar-link">服务管理</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#docker-安装" class="sidebar-link">Docker 安装</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#简单代理" class="sidebar-link">简单代理</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#全局变量" class="sidebar-link">全局变量</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#监听端口" class="sidebar-link">监听端口</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#域名-server-name" class="sidebar-link">域名 (server_name)</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#负载均衡-简单实例" class="sidebar-link">负载均衡(简单实例)</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#负载均衡-权重" class="sidebar-link">负载均衡(权重)</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#upstream-ip-hash" class="sidebar-link">upstream ip_hash</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#upstream-fair" class="sidebar-link">upstream fair</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#server-可选参数" class="sidebar-link">server 可选参数</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#upstream-url-hash" class="sidebar-link">upstream url_hash</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#upstream-keepalive" class="sidebar-link">upstream keepalive</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#子文件夹中的代理" class="sidebar-link">子文件夹中的代理</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#反向代理" class="sidebar-link">反向代理</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#静态资源-传统-web-服务器" class="sidebar-link">静态资源（传统 Web 服务器）</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#https-协议" class="sidebar-link">HTTPS 协议</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#重定向-301永久" class="sidebar-link">重定向(301永久)</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#重定向-302临时" class="sidebar-link">重定向(302临时)</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#永久重定向到-https-安全域" class="sidebar-link">永久重定向到 HTTPS 安全域</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#重定向参数" class="sidebar-link">重定向参数</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#http-请求端真实的ip" class="sidebar-link">HTTP 请求端真实的IP</a></li></ul></li><li><a href="/tool/nginx.html#示例" class="sidebar-link">示例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tool/nginx.html#websocket-的代理-keepalive" class="sidebar-link">websocket 的代理 keepalive</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#apache-的反向代理" class="sidebar-link">Apache 的反向代理</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#gitlab-的反向代理" class="sidebar-link">Gitlab 的反向代理</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#重定向整个网站" class="sidebar-link">重定向整个网站</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#重定向单页" class="sidebar-link">重定向单页</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#重定向整个子路径" class="sidebar-link">重定向整个子路径</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#负载均衡" class="sidebar-link">负载均衡</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#内容缓存" class="sidebar-link">内容缓存</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#跨域问题" class="sidebar-link">跨域问题</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#重定向-uri-来解决跨域问题" class="sidebar-link">重定向 URI 来解决跨域问题</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#跳转到带-www-的域上面" class="sidebar-link">跳转到带 www 的域上面</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#代理转发" class="sidebar-link">代理转发</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#屏蔽-ip" class="sidebar-link">屏蔽 IP</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#强制将-http-重定向到-https" class="sidebar-link">强制将 http 重定向到 https</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#代理转发连接替换" class="sidebar-link">代理转发连接替换</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#爬虫-user-agent-过滤" class="sidebar-link">爬虫 User-Agent 过滤</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#图片防盗链" class="sidebar-link">图片防盗链</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#虚拟目录配置" class="sidebar-link">虚拟目录配置</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#屏蔽文件目录" class="sidebar-link">屏蔽文件目录</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#防盗图配置" class="sidebar-link">防盗图配置</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#阻止常见攻击" class="sidebar-link">阻止常见攻击</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#gzip-配置" class="sidebar-link">Gzip 配置</a></li><li class="sidebar-sub-header"><a href="/tool/nginx.html#使网站不可索引" class="sidebar-link">使网站不可索引</a></li></ul></li><li><a href="/tool/nginx.html#另见" class="sidebar-link">另见</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nginx-备忘清单"><a href="#nginx-备忘清单" class="header-anchor">#</a> NGINX 备忘清单</h1> <p>这个 <a href="https://nginx.org/en/" target="_blank" rel="noopener noreferrer">nginx<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 快速参考备忘单显示了它的常用命和配置使用清单。</p> <h2 id="入门"><a href="#入门" class="header-anchor">#</a> 入门</h2> <h3 id="服务管理"><a href="#服务管理" class="header-anchor">#</a> 服务管理</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl status nginx <span class="token comment"># nginx当前状态</span>
<span class="token function">sudo</span> systemctl reload nginx <span class="token comment"># 重新加载 nginx</span>
<span class="token function">sudo</span> systemctl restart nginx <span class="token comment"># 重启nginx</span>

<span class="token function">sudo</span> nginx <span class="token parameter variable">-t</span>   <span class="token comment"># 检查语法</span>
nginx           <span class="token comment"># 启动</span>
nginx <span class="token parameter variable">-s</span> reload <span class="token comment"># 重启</span>
nginx <span class="token parameter variable">-s</span> stop   <span class="token comment"># 关闭进程</span>
nginx <span class="token parameter variable">-s</span> quit   <span class="token comment"># 平滑关闭nginx</span>
nginx <span class="token parameter variable">-V</span>        <span class="token comment"># 查看nginx的安装状态，</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="docker-安装"><a href="#docker-安装" class="header-anchor">#</a> Docker 安装</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">--name</span> some-nginx <span class="token parameter variable">-v</span> /some/content:/usr/share/nginx/html:ro <span class="token parameter variable">-d</span> nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="简单代理"><a href="#简单代理" class="header-anchor">#</a> 简单代理</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:3000</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">proxy_redirect</span>      <span class="token boolean">off</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">proxy_set_header</span>    Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="全局变量"><a href="#全局变量" class="header-anchor">#</a> 全局变量</h3> <table><thead><tr><th style="text-align:left;">变量</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>$args</code></td> <td style="text-align:left;">这个变量等于请求行中的参数，同 <code>$query_string</code></td></tr> <tr><td style="text-align:left;"><code>$remote_port</code></td> <td style="text-align:left;">客户端的端口</td></tr> <tr><td style="text-align:left;"><code>$content_length</code></td> <td style="text-align:left;">请求头中的 <code>Content-length</code> 字段</td></tr> <tr><td style="text-align:left;"><code>$remote_user</code></td> <td style="text-align:left;">已经经过 <code>Auth Basic Module</code> 验证的用户名</td></tr> <tr><td style="text-align:left;"><code>$content_type</code></td> <td style="text-align:left;">请求头中的 <code>Content-Type</code> 字段</td></tr> <tr><td style="text-align:left;"><code>$request_filename</code></td> <td style="text-align:left;">当前请求的文件路径，由 <code>root</code> 或alias指令与URI请求生成</td></tr> <tr><td style="text-align:left;"><code>$document_root</code></td> <td style="text-align:left;">当前请求在 <code>root</code> 指令中指定的值</td></tr> <tr><td style="text-align:left;"><code>$scheme</code></td> <td style="text-align:left;">HTTP方法（如http，https）</td></tr> <tr><td style="text-align:left;"><code>$host</code></td> <td style="text-align:left;">请求主机头字段，否则为服务器名称</td></tr> <tr><td style="text-align:left;"><code>$hostname</code></td> <td style="text-align:left;">主机名</td></tr> <tr><td style="text-align:left;"><code>$http_user_agent</code></td> <td style="text-align:left;">客户端<code>agent</code>信息</td></tr> <tr><td style="text-align:left;"><code>$http_cookie</code></td> <td style="text-align:left;">客户端<code>cookie</code>信息</td></tr> <tr><td style="text-align:left;"><code>$server_protocol</code></td> <td style="text-align:left;">请求使用的协议，通常是<code>HTTP/1.0</code>或<code>HTTP/1.1</code></td></tr> <tr><td style="text-align:left;"><code>$server_addr</code></td> <td style="text-align:left;">服务器地址，在完成一次系统调用后可以确定这个值</td></tr> <tr><td style="text-align:left;"><code>$server_name</code></td> <td style="text-align:left;">服务器名称</td></tr> <tr><td style="text-align:left;"><code>$server_port</code></td> <td style="text-align:left;">请求到达服务器的端口号</td></tr> <tr><td style="text-align:left;"><code>$limit_rate</code></td> <td style="text-align:left;">这个变量可以限制连接速率</td></tr> <tr><td style="text-align:left;"><code>$request_method</code></td> <td style="text-align:left;">客户端请求的动作，如 GET/POST</td></tr> <tr><td style="text-align:left;"><code>$request_uri</code></td> <td style="text-align:left;">包含请求参数的原始URI，不包含主机名，如：<code>/foo/bar.php?arg=baz</code></td></tr> <tr><td style="text-align:left;"><code>$remote_addr</code></td> <td style="text-align:left;">客户端的IP地址</td></tr> <tr><td style="text-align:left;"><code>$uri</code></td> <td style="text-align:left;">不带请求参数的当前URI，<code>$uri</code>不包含主机名，如 <code>/foo/bar.html</code></td></tr> <tr><td style="text-align:left;"><code>$document_uri</code></td> <td style="text-align:left;">与 <code>$uri</code> 相同</td></tr> <tr><td style="text-align:left;"><code>$nginx_version</code></td> <td style="text-align:left;"><code>nginx</code> 版本</td></tr></tbody></table> <p>更多全局变量<a href="https://nginx.org/en/docs/varindex.html" target="_blank" rel="noopener noreferrer">查看官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="监听端口"><a href="#监听端口" class="header-anchor">#</a> 监听端口</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>      <span class="token comment"># 标准 HTTP 协议</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl</span><span class="token punctuation">;</span> <span class="token comment"># 标准 HTTPS 协议</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl http2</span><span class="token punctuation">;</span> <span class="token comment"># 对于 http2</span>
  <span class="token directive"><span class="token keyword">listen</span> [::]:80</span><span class="token punctuation">;</span> <span class="token comment"># 使用 IPv6 在 80 上收听</span>
  <span class="token comment"># 仅收听使用 IPv6</span>
  <span class="token directive"><span class="token keyword">listen</span> [::]:80 ipv6only=on</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="域名-server-name"><a href="#域名-server-name" class="header-anchor">#</a> 域名 (server_name)</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token comment"># 监听 example.com</span>
  <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
  <span class="token comment"># 监听多个域</span>
  <span class="token directive"><span class="token keyword">server_name</span> example.com www.example.com</span><span class="token punctuation">;</span>
  <span class="token comment"># 监听所有子域</span>
  <span class="token directive"><span class="token keyword">server_name</span> *.example.com</span><span class="token punctuation">;</span>
  <span class="token comment"># 监听所有顶级域</span>
  <span class="token directive"><span class="token keyword">server_name</span> example.*</span><span class="token punctuation">;</span>
  <span class="token comment"># 监听未指定的主机名（监听 IP 地址本身）</span>
  <span class="token directive"><span class="token keyword">server_name</span> <span class="token string">&quot;&quot;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="负载均衡-简单实例"><a href="#负载均衡-简单实例" class="header-anchor">#</a> 负载均衡(简单实例)</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> node_js</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">server</span> 0.0.0.0:3000</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server</span> 0.0.0.0:4000</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server</span> 127.155.142.421</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="负载均衡-权重"><a href="#负载均衡-权重" class="header-anchor">#</a> 负载均衡(权重)</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> test</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">server</span> localhost:8080 weight=9</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server</span> localhost:8081 weight=1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="upstream-ip-hash"><a href="#upstream-ip-hash" class="header-anchor">#</a> upstream ip_hash</h3> <div class="language-nginx line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> test</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">ip_hash</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server</span> localhost:8080</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>解决负载均衡 <code>session</code> 的问题</p> <h3 id="upstream-fair"><a href="#upstream-fair" class="header-anchor">#</a> upstream fair</h3> <div class="language-nginx line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br></div><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">fair</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server</span> localhost:8080</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>响应时间短的优先分配</p> <h3 id="server-可选参数"><a href="#server-可选参数" class="header-anchor">#</a> server 可选参数</h3> <table><thead><tr><th style="text-align:left;">:-</th> <th style="text-align:left;">:-</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>weight</code></td> <td style="text-align:left;">访问权重数值越高，收到请求越多</td></tr> <tr><td style="text-align:left;"><code>fail_timeout</code></td> <td style="text-align:left;">指定的时间内必须提供响应</td></tr> <tr><td style="text-align:left;"><code>max_fails</code></td> <td style="text-align:left;">尝试失败服务器连接的最大次数</td></tr> <tr><td style="text-align:left;"><code>down</code></td> <td style="text-align:left;">标记一个服务器不再接受任何请求</td></tr> <tr><td style="text-align:left;"><code>backup</code></td> <td style="text-align:left;">有服务器宕机，标记的机器接收请求</td></tr></tbody></table> <p>配置示例</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> test</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:83 weight=9</span><span class="token punctuation">;</span> <span class="token comment"># 权重</span>
  <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:83 weight=1</span><span class="token punctuation">;</span> <span class="token comment"># 权重</span>
  <span class="token comment"># 失败超时时间</span>
  <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:83 max_fails=3</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:83 weight=3 down</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="upstream-url-hash"><a href="#upstream-url-hash" class="header-anchor">#</a> upstream url_hash</h3> <div class="language-nginx line-numbers-mode"><div class="highlight-lines"><br><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br></div><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">hash</span> <span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">hash_method</span> crc32</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server</span> localhost:8080</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>按访问url的hash结果来分配请求</p> <h3 id="upstream-keepalive"><a href="#upstream-keepalive" class="header-anchor">#</a> upstream keepalive</h3> <div class="language-nginx line-numbers-mode"><div class="highlight-lines"><br><br><br><div class="highlighted"> </div><br><br></div><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> memcached_backend</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:11211</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">server</span> 10.0.0.2:11211</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">keepalive</span> <span class="token number">32</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>激活缓存以连接到上游服务器</p> <h3 id="子文件夹中的代理"><a href="#子文件夹中的代理" class="header-anchor">#</a> 子文件夹中的代理</h3> <div class="language-nginx line-numbers-mode"><div class="highlight-lines"><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br></div><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /folder/</span> <span class="token punctuation">{</span> <span class="token comment"># / 很重要！</span>
  <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:3000/</span><span class="token punctuation">;</span> <span class="token comment"># / 很重要！</span>
  <span class="token directive"><span class="token keyword">proxy_redirect</span>      <span class="token boolean">off</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">proxy_set_header</span>    Host            <span class="token variable">$host</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">proxy_set_header</span>    X-Real-IP       <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">proxy_set_header</span>    X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="反向代理"><a href="#反向代理" class="header-anchor">#</a> 反向代理</h3> <h4 id="基础"><a href="#基础" class="header-anchor">#</a> 基础</h4> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
  
  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://0.0.0.0:3000</span><span class="token punctuation">;</span>
    <span class="token comment"># 其中 0.0.0.0:3000 是绑定在 </span>
    <span class="token comment"># 0.0.0.0端口3000 列表上的 Node.js 服务器</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="基础-upstream"><a href="#基础-upstream" class="header-anchor">#</a> 基础 + (upstream)</h4> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> node_js</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">server</span> 0.0.0.0:3000</span><span class="token punctuation">;</span>
  <span class="token comment"># 其中 0.0.0.0:3000 是绑定在 </span>
  <span class="token comment"># 0.0.0.0端口3000 列表上的 Node.js 服务器</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
  
  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://node_js</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="升级连接-适用于支持-websockets-的应用程序"><a href="#升级连接-适用于支持-websockets-的应用程序" class="header-anchor">#</a> 升级连接（适用于支持 WebSockets 的应用程序）</h4> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> node_js</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">server</span> 0.0.0.0:3000</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
  
  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://node_js</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_redirect</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;upgrade&quot;</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>适用于 Node.js、Streamlit、Jupyter 等</p> <h3 id="静态资源-传统-web-服务器"><a href="#静态资源-传统-web-服务器" class="header-anchor">#</a> 静态资源（传统 Web 服务器）</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">root</span> /path/to/website</span><span class="token punctuation">;</span>
  <span class="token comment"># root /www/data/ 示例，如果里面没有'root'，它将寻找 /www/data/index.html</span>
  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
  <span class="token directive"><span class="token keyword">location</span> /images/</span> <span class="token punctuation">{</span> <span class="token comment"># 如果里面没有“root”，它将寻找 /www/data/images/index.html</span>
  <span class="token punctuation">}</span>
  <span class="token directive"><span class="token keyword">location</span> /videos/</span> <span class="token punctuation">{</span> <span class="token comment"># 由于里面有“root”，它会寻找 /www/media/videos/index.html</span>
      <span class="token directive"><span class="token keyword">root</span> /www/media</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="https-协议"><a href="#https-协议" class="header-anchor">#</a> HTTPS 协议</h3> <p>大多数 SSL 选项取决于您的应用程序做什么或需要什么</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl http2</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">ssl</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>

  <span class="token directive"><span class="token keyword">ssl_certificate</span> /path/to/cert.pem</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">ssl_certificate_key</span> /path/to/privkey.pem</span><span class="token punctuation">;</span>

  <span class="token directive"><span class="token keyword">ssl_stapling</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">ssl_stapling_verify</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">ssl_trusted_certificate</span> /path/to/fullchain.pem</span><span class="token punctuation">;</span>

  <span class="token directive"><span class="token keyword">ssl_protocols</span> TLSv1 TLSv1.1 TLSv1.2</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">ssl_session_timeout</span> <span class="token number">1d</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">ssl_session_cache</span> shared:SSL:50m</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">add_header</span> Strict-Transport-Security max-age=15768000</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>您可以使用 Let's Encrypt 轻松保护您的网站/应用程序。去 <a href="https://certbot.eff.org/lets-encrypt/ubuntuxenial-nginx.html" target="_blank" rel="noopener noreferrer">lets-encrypt<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 获取更多信息</p> <h3 id="重定向-301永久"><a href="#重定向-301永久" class="header-anchor">#</a> 重定向(301永久)</h3> <p>将 www.example.com 重定向到 example.com</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> www.example.com</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> http://example.com<span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>将 http 重定向到 https</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://example.com<span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="重定向-302临时"><a href="#重定向-302临时" class="header-anchor">#</a> 重定向(302临时)</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> yourdomain.com</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">return</span> <span class="token number">302</span> http://otherdomain.com</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="永久重定向到-https-安全域"><a href="#永久重定向到-https-安全域" class="header-anchor">#</a> 永久重定向到 HTTPS 安全域</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> yourdomain.com</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> https://<span class="token variable">$host</span><span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="重定向参数"><a href="#重定向参数" class="header-anchor">#</a> 重定向参数</h3> <table><thead><tr><th style="text-align:left;">:-</th> <th style="text-align:left;">:-</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>permanent</code></td> <td style="text-align:left;">永久性重定向。日志中的状态码为 <code>301</code></td></tr> <tr><td style="text-align:left;"><code>redirect</code></td> <td style="text-align:left;">临时重定向。日志中的状态码为 <code>302</code></td></tr></tbody></table> <h3 id="http-请求端真实的ip"><a href="#http-请求端真实的ip" class="header-anchor">#</a> HTTP 请求端真实的IP</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div> <h2 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h2> <h3 id="websocket-的代理-keepalive"><a href="#websocket-的代理-keepalive" class="header-anchor">#</a> websocket 的代理 keepalive</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token comment"># Upstreams</span>
<span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:3000</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">keepalive</span> <span class="token number">5</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment"># HTTP Server</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">server_name</span> your_hostname.com</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">error_log</span> /var/log/nginx/rocketchat.access.log</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
      <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span>
      <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span>
      <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span>
      <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;upgrade&quot;</span></span><span class="token punctuation">;</span>
      <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$http_host</span></span><span class="token punctuation">;</span>
      <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
      <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forward-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
      <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forward-Proto http</span><span class="token punctuation">;</span>
      <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Nginx-Proxy true</span><span class="token punctuation">;</span>
      <span class="token directive"><span class="token keyword">proxy_redirect</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div> <h3 id="apache-的反向代理"><a href="#apache-的反向代理" class="header-anchor">#</a> Apache 的反向代理</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">server_name</span> domain.tld</span><span class="token punctuation">;</span>

  <span class="token directive"><span class="token keyword">access_log</span> /log/domain.tld.access.log</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">error_log</span> /log/domain.tld.error.log</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">root</span> /var/www/domain.tld/htdocs</span><span class="token punctuation">;</span>

  <span class="token comment"># 将请求传递给 Apache 后端</span>
  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
      <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment"># 使用后备处理静态文件</span>
  <span class="token directive"><span class="token keyword">location</span> ~* \.(ogg|ogv|svg|svgz|eot|otf|woff|woff2|ttf|m4a|mp4|ttf|rss|atom|jpe?g|gif|cur|heic|png|tiff|ico|zip|webm|mp3|aac|tgz|gz|rar|bz2|doc|xls|exe|ppt|tar|mid|midi|wav|bmp|rtf|swf|webp)$</span> <span class="token punctuation">{</span>
      <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">&quot;Access-Control-Allow-Origin&quot;</span> <span class="token string">&quot;*&quot;</span></span><span class="token punctuation">;</span>
      <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
      <span class="token directive"><span class="token keyword">log_not_found</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
      <span class="token directive"><span class="token keyword">expires</span> max</span><span class="token punctuation">;</span>
      <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> @fallback</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment"># 如果找不到文件，则回退以将请求传递给 Apache</span>
  <span class="token directive"><span class="token keyword">location</span> @fallback</span> <span class="token punctuation">{</span>
      <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div> <h3 id="gitlab-的反向代理"><a href="#gitlab-的反向代理" class="header-anchor">#</a> Gitlab 的反向代理</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token comment">#侦听的80端口</span>
  <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span>  git.example.cn</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span>   http://localhost:3000</span><span class="token punctuation">;</span>
    <span class="token comment"># 以下是一些反向代理的配置可删除</span>
    <span class="token directive"><span class="token keyword">proxy_redirect</span>             <span class="token boolean">off</span></span><span class="token punctuation">;</span>
    <span class="token comment"># 后端的Web服务器可以通过X-Forwarded-For获取用户真实IP</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span>           Host <span class="token variable">$host</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">client_max_body_size</span>       <span class="token number">10m</span></span><span class="token punctuation">;</span>  <span class="token comment"># 允许客户端请求的最大单文件字节数</span>
    <span class="token directive"><span class="token keyword">client_body_buffer_size</span>    <span class="token number">128k</span></span><span class="token punctuation">;</span> <span class="token comment"># 缓冲区代理缓冲用户端请求的最大字节数</span>
    <span class="token directive"><span class="token keyword">proxy_connect_timeout</span>      <span class="token number">300</span></span><span class="token punctuation">;</span>  <span class="token comment"># nginx跟后端服务器连接超时时间(代理连接超时)</span>
    <span class="token directive"><span class="token keyword">proxy_send_timeout</span>         <span class="token number">300</span></span><span class="token punctuation">;</span>  <span class="token comment"># 后端服务器数据回传时间(代理发送超时)</span>
    <span class="token directive"><span class="token keyword">proxy_read_timeout</span>         <span class="token number">300</span></span><span class="token punctuation">;</span>  <span class="token comment"># 连接成功后，后端服务器响应时间(代理接收超时)</span>
    <span class="token comment"># 设置代理服务器（nginx）保存用户头信息的缓冲区大小</span>
    <span class="token directive"><span class="token keyword">proxy_buffer_size</span>          <span class="token number">4k</span></span><span class="token punctuation">;</span>
    <span class="token comment"># proxy_buffers缓冲区，网页平均在32k以下的话，这样设置</span>
    <span class="token directive"><span class="token keyword">proxy_buffers</span>              <span class="token number">4</span> <span class="token number">32k</span></span><span class="token punctuation">;</span>
    <span class="token comment"># 高负荷下缓冲大小（proxy_buffers*2）</span>
    <span class="token directive"><span class="token keyword">proxy_busy_buffers_size</span>    <span class="token number">64k</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="重定向整个网站"><a href="#重定向整个网站" class="header-anchor">#</a> 重定向整个网站</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">server_name</span> old-site.com</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> <span class="token variable">$scheme</span>://new-site.com<span class="token variable">$request_uri</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div> <h3 id="重定向单页"><a href="#重定向单页" class="header-anchor">#</a> 重定向单页</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">location</span> = /oldpage.html</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> http://example.org/newpage.html</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div> <h3 id="重定向整个子路径"><a href="#重定向整个子路径" class="header-anchor">#</a> 重定向整个子路径</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /old-site</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">rewrite</span> ^/old-site/(.*) http://example.org/new-site/<span class="token variable">$1</span> permanent</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div> <h3 id="负载均衡"><a href="#负载均衡" class="header-anchor">#</a> 负载均衡</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> example</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">ip_hash</span></span><span class="token punctuation">;</span>
  <span class="token comment"># upstream的负载均衡，weight是权重，可以根据机器配置定义权重。</span>
  <span class="token comment"># weigth参数表示权值，权值越高被分配到的几率越大。</span>
  <span class="token directive"><span class="token keyword">server</span> 192.168.122.11:8081</span> <span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:82 weight=3</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:83 weight=3 down</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:84 weight=3</span><span class="token punctuation">;</span> <span class="token directive"><span class="token keyword">max_fails=3</span>  fail_timeout=20s</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:85 weight=4</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">keepalive</span> <span class="token number">32</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token comment">#侦听的80端口</span>
  <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span>  git.example.cn</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token comment"># 在这里设置一个代理，和 upstream 的名字一样</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span>   http://example</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="内容缓存"><a href="#内容缓存" class="header-anchor">#</a> 内容缓存</h3> <p>允许浏览器基本上永久地缓存静态内容。 Nginx 将为您设置 Expires 和 Cache-Control 头信息</p> <div class="language-nginx line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br></div><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /static</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">root</span> /data</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">expires</span> max</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>如果要求浏览器永远不会缓存响应（例如用于跟踪请求），请使用 <code>-1</code></p> <div class="language-nginx line-numbers-mode"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br></div><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> = /empty.gif</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">empty_gif</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">expires</span> -1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="跨域问题"><a href="#跨域问题" class="header-anchor">#</a> 跨域问题</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> api.xxx.com</span><span class="token punctuation">;</span>
    
  <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Origin'</span> <span class="token string">'*'</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Credentials'</span> <span class="token string">'true'</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">add_header</span> <span class="token string">'Access-Control-Allow-Methods'</span> <span class="token string">'GET,POST,HEAD'</span></span><span class="token punctuation">;</span>

  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:3000</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">proxy_set_header</span> Host  <span class="token variable">$http_host</span></span><span class="token punctuation">;</span>    
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="重定向-uri-来解决跨域问题"><a href="#重定向-uri-来解决跨域问题" class="header-anchor">#</a> 重定向 URI 来解决跨域问题</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> test</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:8080</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server</span> localhost:8081</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span> api.xxx.com</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span> 
    <span class="token directive"><span class="token keyword">root</span>  html</span><span class="token punctuation">;</span>                   <span class="token comment"># 去请求../html文件夹里的文件</span>
    <span class="token directive"><span class="token keyword">index</span>  index.html index.htm</span><span class="token punctuation">;</span>  <span class="token comment"># 首页响应地址</span>
  <span class="token punctuation">}</span>
  <span class="token comment"># 用于拦截请求，匹配任何以 /api/开头的地址，</span>
  <span class="token comment"># 匹配符合以后，停止往下搜索正则。</span>
  <span class="token directive"><span class="token keyword">location</span> ^~/api/</span><span class="token punctuation">{</span> 
    <span class="token comment"># 代表重写拦截进来的请求，并且只能对域名后边的除去传递的参数外的字符串起作用</span>
    <span class="token comment"># 例如www.a.com/api/msg?meth=1&amp;par=2重写，只对/api/msg重写。</span>
    <span class="token comment"># rewrite后面的参数是一个简单的正则 ^/api/(.*)$，</span>
    <span class="token comment"># $1代表正则中的第一个()，$2代表第二个()的值，以此类推。</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^/api/(.*)$ /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
    
    <span class="token comment"># 把请求代理到其他主机 </span>
    <span class="token comment"># 其中 http://www.b.com/ 写法和 http://www.b.com写法的区别如下</span>
    <span class="token comment"># 如果你的请求地址是他 http://server/html/test.jsp</span>
    <span class="token comment"># 配置一： http://www.b.com/ 后面有“/” </span>
    <span class="token comment">#         将反向代理成 http://www.b.com/html/test.jsp 访问</span>
    <span class="token comment"># 配置一： http://www.b.com 后面没有有“/” </span>
    <span class="token comment">#         将反向代理成 http://www.b.com/test.jsp 访问</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://test</span><span class="token punctuation">;</span>

    <span class="token comment"># 如果 proxy_pass  URL 是 http://a.xx.com/platform/ 这种情况</span>
    <span class="token comment"># proxy_cookie_path应该设置成 /platform/ / (注意两个斜杠之间有空格)。</span>
    <span class="token directive"><span class="token keyword">proxy_cookie_path</span> /platfrom/ /</span><span class="token punctuation">;</span>

    <span class="token comment"># 设置 Cookie 头通过</span>
    <span class="token directive"><span class="token keyword">proxy_pass_header</span> Set-Cookie</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><h3 id="跳转到带-www-的域上面"><a href="#跳转到带-www-的域上面" class="header-anchor">#</a> 跳转到带 www 的域上面</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token comment"># 配置正常的带www的域名</span>
  <span class="token directive"><span class="token keyword">server_name</span> www.wangchujiang.com</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">root</span> /home/www/wabg/download</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
      <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html =404</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token comment"># 将不带 www 的 wangchujiang.com </span>
  <span class="token comment"># 永久性重定向到 https://www.wangchujiang.com</span>
  <span class="token directive"><span class="token keyword">server_name</span> wangchujiang.com</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">rewrite</span> ^(.*) https://www.wangchujiang.com<span class="token variable">$1</span> permanent</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="代理转发"><a href="#代理转发" class="header-anchor">#</a> 代理转发</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">upstream</span> server-api</span> <span class="token punctuation">{</span>
  <span class="token comment"># api 代理服务地址</span>
  <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:3110</span><span class="token punctuation">;</span>    
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">upstream</span> server-resource</span> <span class="token punctuation">{</span>
  <span class="token comment"># 静态资源 代理服务地址</span>
  <span class="token directive"><span class="token keyword">server</span> 127.0.0.1:3120</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">3111</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span>  localhost</span><span class="token punctuation">;</span> <span class="token comment"># 这里指定域名</span>
  <span class="token directive"><span class="token keyword">root</span> /home/www/server-statics</span><span class="token punctuation">;</span>
  <span class="token comment"># 匹配 api 路由的反向代理到API服务</span>
  <span class="token directive"><span class="token keyword">location</span> ^~/api/</span> <span class="token punctuation">{</span>
      <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
      <span class="token directive"><span class="token keyword">proxy_pass</span> http://server-api</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment"># 假设这里验证码也在API服务中</span>
  <span class="token directive"><span class="token keyword">location</span> ^~/captcha</span> <span class="token punctuation">{</span>
      <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
      <span class="token directive"><span class="token keyword">proxy_pass</span> http://server-api</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment"># 假设你的图片资源全部在另外一个服务上面</span>
  <span class="token directive"><span class="token keyword">location</span> ^~/img/</span> <span class="token punctuation">{</span>
      <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ /<span class="token variable">$1</span> break</span><span class="token punctuation">;</span>
      <span class="token directive"><span class="token keyword">proxy_pass</span> http://server-resource</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment"># 路由在前端，后端没有真实路由，</span>
  <span class="token comment"># 路由不存在的 404 状态的页面返回 /index.html</span>
  <span class="token comment"># 使用场景，用在 React/Vue项目没有真实路由</span>
  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html =404</span><span class="token punctuation">;</span>
    <span class="token comment">#                      空格很重要 ^</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h3 id="屏蔽-ip"><a href="#屏蔽-ip" class="header-anchor">#</a> 屏蔽 IP</h3> <p>可以放到 <code>http</code>, <code>server</code>, <code>location</code>, <code>limit_except</code> 语句块</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">include</span> blockip.conf</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在 <code>blockip.conf</code> 里面输入内容，如：</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">deny</span> 165.91.122.67</span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">deny</span> IP</span><span class="token punctuation">;</span>            <span class="token comment"># 屏蔽单个 ip 访问</span>
<span class="token directive"><span class="token keyword">allow</span> IP</span><span class="token punctuation">;</span>           <span class="token comment"># 允许单个 ip 访问</span>
<span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>           <span class="token comment"># 屏蔽所有 ip 访问</span>
<span class="token directive"><span class="token keyword">allow</span> all</span><span class="token punctuation">;</span>          <span class="token comment"># 允许所有 ip 访问</span>
<span class="token directive"><span class="token keyword">deny</span> 123.0.0.0/8</span><span class="token punctuation">;</span>   <span class="token comment"># 屏蔽整个段即从 123.0.0.1 到 123.255.255.254 访问的命令</span>
<span class="token directive"><span class="token keyword">deny</span> 124.45.0.0/16</span><span class="token punctuation">;</span> <span class="token comment"># 屏蔽IP段即从 123.45.0.1 到 123.45.255.254 访问的命令</span>
<span class="token directive"><span class="token keyword">deny</span> 123.45.6.0/24</span><span class="token punctuation">;</span> <span class="token comment"># 屏蔽IP段即从 123.45.6.1 到 123.45.6.254 访问的命令</span>

<span class="token comment"># 如果你想实现这样的应用，除了几个IP外，其他全部拒绝</span>
<span class="token directive"><span class="token keyword">allow</span> 1.1.1.1</span><span class="token punctuation">;</span> 
<span class="token directive"><span class="token keyword">allow</span> 1.1.1.2</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="强制将-http-重定向到-https"><a href="#强制将-http-重定向到-https" class="header-anchor">#</a> 强制将 http 重定向到 https</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span>       <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span>  example.com</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">rewrite</span> ^ https://<span class="token variable">$http_host</span><span class="token variable">$request_uri?</span> permanent</span><span class="token punctuation">;</span> <span class="token comment"># 强制将 http 重定向到 https</span>
  <span class="token comment"># 在错误页面和“服务器”响应头字段中启用或禁用发射nginx版本。 防止黑客利用版本漏洞攻击</span>
  <span class="token directive"><span class="token keyword">server_tokens</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="代理转发连接替换"><a href="#代理转发连接替换" class="header-anchor">#</a> 代理转发连接替换</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ^~/api/upload</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ /wfs/v1/upload break</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">proxy_pass</span> http://wfs-api</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>将地址 <code>/api/upload</code> 替换为 <code>/wfs/v1/upload</code></p> <h3 id="爬虫-user-agent-过滤"><a href="#爬虫-user-agent-过滤" class="header-anchor">#</a> 爬虫 User-Agent 过滤</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$http_user_agent</span> ~* <span class="token string">&quot;python|curl|java|wget|httpclient|okhttp&quot;</span>)</span> <span class="token punctuation">{</span>
      <span class="token directive"><span class="token keyword">return</span> <span class="token number">503</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment"># 正常处理</span>
  <span class="token comment"># ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="图片防盗链"><a href="#图片防盗链" class="header-anchor">#</a> 图片防盗链</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ~* \.(gif|jpg|png|swf|flv)$</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">root</span> html</span><span class="token punctuation">;</span>

  <span class="token directive"><span class="token keyword">valid_referers</span> none blocked *.nginx.com</span><span class="token punctuation">;</span>

  <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$invalid_referer</span>)</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">rewrite</span> ^/ www.nginx.cn</span><span class="token punctuation">;</span>
    <span class="token comment"># return 404;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="虚拟目录配置"><a href="#虚拟目录配置" class="header-anchor">#</a> 虚拟目录配置</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> /img/</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">alias</span> /var/www/image/</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment"># 访问 /img/ 目录里面的文件时，</span>
<span class="token comment"># 会自动去 /var/www/image/ 目录找文件</span>
<span class="token directive"><span class="token keyword">location</span> /img/</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">root</span> /var/www/image</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment"># 访问 /img/ 目录下的文件时，</span>
<span class="token comment"># 会去 /var/www/image/img/ 目录下找文件</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="屏蔽文件目录"><a href="#屏蔽文件目录" class="header-anchor">#</a> 屏蔽文件目录</h3> <p>通用备份和归档文件</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ~* <span class="token string">&quot;\.(old|orig|original|php#|php~|php_bak|save|swo|aspx?|tpl|sh|bash|bak?|cfg|cgi|dll|exe|git|hg|ini|jsp|log|mdb|out|sql|svn|swp|tar|rdf)$&quot;</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div> <p>拒绝访问 <code>.git</code> 和 <code>.svn</code> 目录</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ~ (.git|.svn)</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div> <p>拒绝访问隐藏文件和目录</p> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ~ /\.(?!well-known\/)</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="防盗图配置"><a href="#防盗图配置" class="header-anchor">#</a> 防盗图配置</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ~ \/public\/(css|js|img)\/.*\.(js|css|gif|jpg|jpeg|png|bmp|swf)</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">valid_referers</span> none blocked *.jslite.io</span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$invalid_referer</span>)</span> <span class="token punctuation">{</span>
      <span class="token directive"><span class="token keyword">rewrite</span> ^/  http://wangchujiang.com/piratesp.png</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="阻止常见攻击"><a href="#阻止常见攻击" class="header-anchor">#</a> 阻止常见攻击</h3> <h4 id="base64编码的网址"><a href="#base64编码的网址" class="header-anchor">#</a> base64编码的网址</h4> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ~* <span class="token string">&quot;(base64_encode)(.*)(\()&quot;</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="javascript-eval-url"><a href="#javascript-eval-url" class="header-anchor">#</a> javascript eval() url</h4> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">location</span> ~* <span class="token string">&quot;(eval\()&quot;</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">deny</span> all</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="gzip-配置"><a href="#gzip-配置" class="header-anchor">#</a> Gzip 配置</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">gzip</span>  <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_buffers</span> <span class="token number">16</span> <span class="token number">8k</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_comp_level</span> <span class="token number">6</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_http_version</span> 1.1</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_min_length</span> <span class="token number">256</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_proxied</span> any</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_vary</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_types</span>
    text/xml application/xml application/atom+xml application/rss+xml application/xhtml+xml image/svg+xml
    text/javascript application/javascript application/x-javascript
    text/x-json application/json application/x-web-app-manifest+json
    text/css text/plain text/x-component
    font/opentype application/x-font-ttf application/vnd.ms-fontobject
    image/x-icon</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">gzip_disable</span>  <span class="token string">&quot;msie6&quot;</span></span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="使网站不可索引"><a href="#使网站不可索引" class="header-anchor">#</a> 使网站不可索引</h3> <div class="language-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">add_header</span> X-Robots-Tag <span class="token string">&quot;noindex&quot;</span></span><span class="token punctuation">;</span>

<span class="token directive"><span class="token keyword">location</span> = /robots.txt</span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;User-agent: *<span class="token escape entity">\n</span>Disallow: /<span class="token escape entity">\n</span>&quot;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="另见"><a href="#另见" class="header-anchor">#</a> 另见</h2> <ul><li><a href="https://jaywcjlove.github.io/nginx-tutorial" target="_blank" rel="noopener noreferrer">Nginx 安装维护入门学习笔记<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <em>(jaywcjlove.github.io)</em></li> <li><a href="https://virtubox.github.io/advanced-nginx-cheatsheet/" target="_blank" rel="noopener noreferrer">advanced-nginx-cheatsheet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <em>(virtubox.github.io)</em></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c8ed8bcf.js" defer></script><script src="/assets/js/2.f44a4f26.js" defer></script><script src="/assets/js/128.029c8965.js" defer></script>
  </body>
</html>
